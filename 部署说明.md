# “材智通——智慧材料库数字化管理系统” 样机部署说明

本说明描述如何在本地环境中启动仓库内新增的 FastAPI 后端样机，以支持课堂答辩及演示。

## 1. 环境依赖

- Python 3.10 及以上版本（推荐 3.11）
- 可访问互联网的终端用于首次安装依赖
- `bash` 终端（Windows 可使用 WSL/Git Bash）

> 数据库使用内嵌 SQLite，无需单独安装 MySQL/PostgreSQL。

## 2. 一键启动

项目根目录已提供 `run.sh`，其流程如下：

1. 创建/复用 `.venv` 虚拟环境；
2. 安装 `requirements.txt` 中声明的依赖；
3. 启动 FastAPI 服务（默认监听 `0.0.0.0:8000`）。

在仓库根目录执行：

```bash
./run.sh
```

首次运行会自动在 `materials_app/materials.db` 生成数据库文件，并写入示例账号、类目与库存数据。

## 3. 手动启动（可选）

如果希望手动操作，可执行：

```bash
python3 -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
uvicorn materials_app.main:app --reload
```

## 4. 访问方式

- 接口文档：`http://127.0.0.1:8000/docs`
- 根路径返回健康检查信息及演示账号。

全部业务接口均基于 REST，支持 Swagger/Redoc 在线调试。前端可通过 Fetch/axios 等方式直接调用接口，或在未来替换为 React/Vue 等框架。

## 5. 预置演示账号

| 角色     | 用户名 | 密码   | 说明                     |
|----------|--------|--------|--------------------------|
| 管理员   | admin  | 123456 | 管理用户、类目、报表导出 |
| 实验员   | lab    | 123456 | 入库、库存查询、审批领用 |
| 学生     | stu    | 123456 | 查询材料、发起领用       |

## 6. 功能对照

- **FR1 登录与权限控制**：OAuth2 + JWT 登录，接口按角色鉴权，未授权访问返回 401/403。
- **FR2 材料类目/信息**：支持三级类目、材料基础信息增删改查与分页查询。
- **FR3 入库管理**：实验员录入入库记录，自动累加库存，可按日期/材料过滤。
- **FR4 领用管理**：学生提交领用，实验员审核，超量自动阻止；学生可查询“我的领用”。
- **FR5 库存查询/预警**：提供库存总览 API，返回安全库存告警标记。
- **FR6 报表导出**：管理员可导出领用明细与当前库存（CSV）。

## 7. 二次开发提示

- 所有 Python 源码位于 `materials_app/`；`materials_app/main.py` 包含 FastAPI 路由。
- `materials_app/init_data.py` 负责初始化示例数据，可根据需要扩展。
- 静态/前端资源可放置于新目录（如 `frontend/`），再通过 Nginx 或 FastAPI StaticFiles 提供。

如需在课程答辩中演示，只需按照第 2 节执行脚本，浏览器访问 `/docs` 即可完成全流程演示。祝答辩顺利！
